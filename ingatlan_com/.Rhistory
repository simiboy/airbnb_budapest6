setwd("C:/Users/ThinkPad/Desktop/airbnb_scrape/ingatlan_com")
# Load required packages
library(dplyr)
library(stringr)
library(readr)
# Read the CSV file
df <- read_csv("2025_11_05.csv")
# Load required packages
library(dplyr)
library(stringr)
library(readr)
library(ggplot2)
library(knitr)
# ---- 1. Load all CSV files from the data folder ----
file_list <- list.files("data", pattern = "\\d{4}-\\d{2}-\\d{2}\\.csv$", full.names = TRUE)
# Function to read and process a single CSV file
process_file <- function(file_path) {
# Extract date from filename
date <- str_extract(basename(file_path), "\\d{4}-\\d{2}-\\d{2}") |> as.Date()
# Read CSV
df <- read_csv(file_path)
# Clean and convert columns
df <- df %>%
mutate(
price = str_remove_all(price, "Ft/hó| | ") |> as.numeric(),
district = str_extract(location, "Budapest\\s+([IVXLC]+)\\.\\s+kerület") |>
str_remove_all("Budapest\\s+|\\.\\s+kerület|\\s+"),
alapterulet = str_remove(alapterulet, " m2") |> as.numeric(),
erkely = str_remove(erkely, " m2") |> as.numeric(),
price_sqm = price / alapterulet,
date = date
)
return(df)
}
# Process all files and combine into one data frame
all_data <- lapply(file_list, process_file) |> bind_rows()
# ---- 2. Summary statistics over time ----
# Listings per district per date
count_per_district <- all_data %>%
group_by(date, district) %>%
summarise(n_listings = n(), .groups = "drop")
# Mean and median prices per district per date
price_stats <- all_data %>%
group_by(date, district) %>%
summarise(
mean_price = mean(price, na.rm = TRUE),
median_price = median(price, na.rm = TRUE),
mean_price_sqm = mean(price_sqm, na.rm = TRUE),
median_price_sqm = median(price_sqm, na.rm = TRUE),
n = n(),
.groups = "drop"
)
# ---- 3. Print a sample summary ----
kable(price_stats, digits = 0, caption = "Budapest District Rental Summary Over Time")
# ---- 4. Visualizations ----
# Mean price per m² trend over time per district
ggplot(price_stats, aes(x = date, y = mean_price_sqm, color = district)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
labs(
title = "Mean Rent Price per m² Over Time by District",
x = "Date",
y = "Mean Price (Ft/m²)"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
# Number of listings trend over time per district
ggplot(count_per_district, aes(x = date, y = n_listings, color = district)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
labs(
title = "Number of Listings Over Time by District",
x = "Date",
y = "Count of Listings"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
# ---- 4. Visualizations ----
# Mean price per m² trend over time per district
# ---- Define custom colors ----
district_colors <- c(
"VI"  = "red",                           # 6th district
"I"   = "yellow", "II" = "yellow",       # 1st, 2nd
"V"   = "yellow", "VII" = "yellow",
"VIII"= "yellow", "IX" = "yellow",
"XI"  = "yellow", "XIII" = "yellow"
)
# For all other districts not in the vector, default to grey
all_districts <- unique(price_stats$district)
for(d in all_districts) {
if(!d %in% names(district_colors)) district_colors[d] <- "grey"
}
# ---- Mean price per m² trend over time ----
ggplot(price_stats, aes(x = date, y = mean_price_sqm, color = district)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
scale_color_manual(values = district_colors) +
labs(
title = "Mean Rent Price per m² Over Time by District",
x = "Date",
y = "Mean Price (Ft/m²)"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
# ---- Number of listings trend over time ----
ggplot(count_per_district, aes(x = date, y = n_listings, color = district)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
scale_color_manual(values = district_colors) +
labs(
title = "Number of Listings Over Time by District",
x = "Date",
y = "Count of Listings"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
# ---- Mean price per m² trend over time ----
ggplot(price_stats, aes(x = date, y = mean_price_sqm, color = district)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
scale_color_manual(values = district_colors) +
labs(
title = "Mean Rent Price per m² Over Time by District",
x = "Date",
y = "Mean Price (Ft/m²)"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
# Mean and median prices per district per date
price_stats <- all_data %>%
group_by(date, district) %>%
summarise(
mean_price = mean(price, na.rm = TRUE),
median_price = median(price, na.rm = TRUE),
mean_price_sqm = mean(price_sqm, na.rm = TRUE),
median_price_sqm = median(price_sqm, na.rm = TRUE),
n = n(),
.groups = "drop"
)
# ---- 3. Print a sample summary ----
kable(price_stats, digits = 0, caption = "Budapest District Rental Summary Over Time")
# ---- Number of listings trend over time ----
ggplot(count_per_district, aes(x = date, y = n_listings, color = district)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
scale_color_manual(values = district_colors) +
labs(
title = "Number of Listings Over Time by District",
x = "Date",
y = "Count of Listings"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
# ---- 4. Visualizations ----
# Mean price per m² trend over time per district
# ---- Define custom colors ----
district_colors <- c(
"VI"  = "red",                           # 6th district
"I"   = "darkgrey", "II" = "darkgrey",       # 1st, 2nd
"V"   = "darkgrey", "VII" = "darkgrey",
"VIII"= "darkgrey", "IX" = "darkgrey",
"XI"  = "darkgrey", "XIII" = "darkgrey"
)
# For all other districts not in the vector, default to grey
all_districts <- unique(price_stats$district)
for(d in all_districts) {
if(!d %in% names(district_colors)) district_colors[d] <- "grey"
}
# ---- Mean price per m² trend over time ----
ggplot(price_stats, aes(x = date, y = mean_price_sqm, color = district)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
scale_color_manual(values = district_colors) +
labs(
title = "Mean Rent Price per m² Over Time by District",
x = "Date",
y = "Mean Price (Ft/m²)"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
# ---- Number of listings trend over time ----
ggplot(count_per_district, aes(x = date, y = n_listings, color = district)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
scale_color_manual(values = district_colors) +
labs(
title = "Number of Listings Over Time by District",
x = "Date",
y = "Count of Listings"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
# ---- 4. Visualizations ----
# Mean price per m² trend over time per district
# ---- Define custom colors ----
district_colors <- c(
"VI"  = "red",                           # 6th district
"I"   = "darkgrey", "II" = "darkgrey",       # 1st, 2nd
"V"   = "darkgrey", "VII" = "darkgrey",
"VIII"= "darkgrey", "IX" = "darkgrey",
"XI"  = "darkgrey", "XIII" = "darkgrey"
)
# For all other districts not in the vector, default to grey
all_districts <- unique(price_stats$district)
for(d in all_districts) {
if(!d %in% names(district_colors)) district_colors[d] <- "lightgrey"
}
# ---- Mean price per m² trend over time ----
ggplot(price_stats, aes(x = date, y = mean_price_sqm, color = district)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
scale_color_manual(values = district_colors) +
labs(
title = "Mean Rent Price per m² Over Time by District",
x = "Date",
y = "Mean Price (Ft/m²)"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
# ---- Number of listings trend over time ----
ggplot(count_per_district, aes(x = date, y = n_listings, color = district)) +
geom_line(size = 1.2) +
geom_point(size = 2) +
scale_color_manual(values = district_colors) +
labs(
title = "Number of Listings Over Time by District",
x = "Date",
y = "Count of Listings"
) +
theme_minimal(base_size = 14) +
theme(legend.position = "bottom")
